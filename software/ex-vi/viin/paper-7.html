<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
<TITLE>An Introduction to Display Editing with Vi - Section 8</TITLE>
<!-- Sccsid @(#)paper-7.html	1.7 (gritter) 3/8/02 -->
<!-- This file was originally generated by unroff 1.0, 03/14/97 13:33:36. -->
<!-- Derived from the FreeBSD document collection. -->
<LINK REL=stylesheet TYPE="text/css" HREF="paper.css">
</HEAD><BODY>
<H2><A NAME="section45">7.</A>&nbsp;&nbsp;Nitty-gritty details
</H2>
<H2><A NAME="section46">7.1.</A>&nbsp;&nbsp;Line representation in the display
</H2>
<P>
&nbsp;&nbsp;The editor folds long logical lines onto many physical lines in the display.
Commands which advance lines advance logical lines and will skip
over all the segments of a line in one motion.  The command <B>|</B> moves
the cursor to a specific column, and may be useful for getting near the
middle of a long line to split it in half.  Try <B>80|</B> on a line which
is more than 80 columns long
(<A HREF="paper-notes.html#7-1">footnote 7-1</A>).
<P>
&nbsp;&nbsp;The editor only puts full lines on the display; if there is not enough
room on the display to fit a logical line, the editor leaves the physical
line empty, placing only an @ on the line as a place holder.  When you
delete lines on a dumb terminal, the editor will often just clear the
lines to @ to save time (rather than rewriting the rest of the screen.)
You can always maximize the information on the screen by giving the <B>^R</B>
command.
<P>
&nbsp;&nbsp;If you wish, you can have the editor place line numbers before each line
on the display.  Give the command <B>:se nu</B>CR to enable
this, and the command <B>:se nonu</B>CR to turn it off.
You can have tabs represented as <B>^I</B> and the ends of lines indicated
with '$' by giving the command <B>:se list</B>CR;
<B>:se nolist</B>CR turns this off.
<P>
&nbsp;&nbsp;Finally, lines consisting of only the character '~' are displayed when
the last line in the file is in the middle of the screen.  These represent
physical lines which are past the logical end of file.
<H2><A NAME="section47">7.2.</A>&nbsp;&nbsp;Counts
</H2>
<P>
&nbsp;&nbsp;Most
<I>vi
</I>commands will use a preceding count to affect their behavior in some way.
The following table gives the common ways in which the counts are used:
<P>
<DIV STYLE="margin-left: 20pt;">
<TABLE>
<TR><TD>new window size&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD><B>:  /  ?  [[  ]]  `  ´</B></TR></TD>
<TR><TD>scroll amount&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD><B>^D  ^U</B></TR></TD>
<TR><TD>line/column number&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD><B>z  G  |</B></TR></TD>
<TR><TD>repeat effect&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>most of the rest</TR></TD>
</TABLE>
</DIV>
<P>
&nbsp;&nbsp;The editor maintains a notion of the current default window size.
On terminals which run at speeds greater than 1200 baud
the editor uses the full terminal screen.
On terminals which are slower than 1200 baud
(most dialup lines are in this group)
the editor uses 8 lines as the default window size.
At 1200 baud the default is 16 lines.
<P>
&nbsp;&nbsp;This size is the size used when the editor clears and refills the screen
after a search or other motion moves far from the edge of the current window.
The commands which take a new window size as count all often cause the
screen to be redrawn.  If you anticipate this, but do not need as large
a window as you are currently using, you may wish to change the screen
size by specifying the new size before these commands.
In any case, the number of lines used on the screen will expand if you
move off the top with a <B>-</B> or similar command or off the bottom
with a command such as RETURN or <B>^D</B>.
The window will revert to the last specified size the next time it is
cleared and refilled
(<A HREF="paper-notes.html#7-2">footnote 7-2</A>).
<P>
&nbsp;&nbsp;The scroll commands <B>^D</B> and <B>^U</B> likewise remember the amount
of scroll last specified, using half the basic window size initially.
The simple insert commands use a count to specify a repetition of the
inserted text.  Thus <B>10a+----</B>ESC will insert a grid-like
string of text.
A few commands also use a preceding count as a line or column number.
<P>
&nbsp;&nbsp;Except for a few commands which ignore any counts (such as <B>^R</B>),
the rest of the editor commands use a count to indicate a simple repetition
of their effect.  Thus <B>5w</B> advances five words on the current line,
while <B>5</B>RETURN advances five lines.  A very useful instance
of a count as a repetition is a count given to the <B>.</B> command, which
repeats the last changing command.  If you do <B>dw</B> and then <B>3.</B>,
you will delete first one and then three words.  You can then delete
two more words with <B>2.</B>.
<H2><A NAME="section48">7.3.</A>&nbsp;&nbsp;More file manipulation commands
</H2>
<P>
&nbsp;&nbsp;The following table lists the file manipulation commands which you can
use when you are in
<I>vi.</I>
<P>
<DIV STYLE="margin-left: 20pt;">
<TABLE>
<TR><TD><B>:w</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>write back changes</TD></TR>
<TR><TD><B>:wq</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>write and quit</TD></TR>
<TR><TD><B>:x</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>write (if necessary) and quit (same as ZZ).</TD></TR>
<TR><TD><B>:e</B> <I>name</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>edit file name</TD></TR>
<TR><TD><B>:e!</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>reedit, discarding changes</TD></TR>
<TR><TD><B>:e +</B> <I>name</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>edit, starting at end</TD></TR>
<TR><TD><B>:e +</B><I>n</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>edit, starting at line n</TD></TR>
<TR><TD><B>:e #</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>edit alternate file</TD></TR>
<TR><TD><B>:w</B> <I>name</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>write file name</TD></TR>
<TR><TD><B>:w!</B> <I>name</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>overwrite file name</TD></TR>
<TR><TD><B>:</B><I>x,y</I><B>w</B> <I>name</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>write lines x through y to name</TD></TR>
<TR><TD><B>:r</B> <I>name</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>read file name into buffer</TD></TR>
<TR><TD><B>:r !</B><I>cmd</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>read output of cmd into buffer</TD></TR>
<TR><TD><B>:n</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>edit next file in argument list</TD></TR>
<TR><TD><B>:n!</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>edit next file, discarding changes to current</TD></TR>
<TR><TD><B>:n</B> <I>args</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>specify new argument list</TD></TR>
<TR><TD><B>:ta</B> <I>tag</I>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>edit file containing tag tag, at tag</TD></TR>
</TABLE>
</DIV>
<P>
All of these commands are followed by a CR or ESC.
The most basic commands are <B>:w</B> and <B>:e</B>.
A normal editing session on a single file will end with a <B>ZZ</B> command.
If you are editing for a long period of time you can give <B>:w</B> commands
occasionally after major amounts of editing, and then finish
with a <B>ZZ</B>.   When you edit more than one file, you can finish
with one with a <B>:w</B> and start editing a new file by giving a <B>:e</B>
command,
or set
<I>autowrite
</I>and use <B>:n</B> &lt;file&gt;.
<P>
&nbsp;&nbsp;If you make changes to the editor's copy of a file, but do not wish to
write them back, then you must give an <B>!</B> after the command you
would otherwise use; this forces the editor to discard any changes
you have made.  Use this carefully.
<P>
&nbsp;&nbsp;The <B>:e</B> command can be given a <B>+</B> argument to start at the
end of the file, or a <B>+</B><I>n</I> argument to start at line <I>n</I>.
In actuality, <I>n</I> may be any editor command not containing a space,
usefully a scan like <B>+/</B><I>pat</I> or <B>+?</B><I>pat</I>.
In forming new names to the <B>e</B> command, you can use the character
<B>%</B> which is replaced by the current file name, or the character
<B>#</B> which is replaced by the alternate file name.
The alternate file name is generally the last name you typed other than
the current file.  Thus if you try to do a <B>:e</B> and get a diagnostic
that you haven't written the file, you can give a <B>:w</B> command and
then a <B>:e #</B> command to redo the previous <B>:e</B>.
<P>
&nbsp;&nbsp;You can write part of the buffer to a file by finding out the lines
that bound the range to be written using <B>^G</B>, and giving these
numbers after the <B>:</B>
and before the <B>w</B>, separated by <B>,</B>'s.
You can also mark these lines with <B>m</B> and
then use an address of the form <B>'</B><I>x</I><B>,</B><B>'</B><I>y</I>
on the <B>w</B> command here.
<P>
&nbsp;&nbsp;You can read another file into the buffer after the current line by using
the <B>:r</B> command.
You can similarly read in the output from a command, just use <B>!</B><I>cmd</I>
instead of a file name.
<P>
&nbsp;&nbsp;If you wish to edit a set of files in succession, you can give all the
names on the command line, and then edit each one in turn using the command
<B>:n</B>.  It is also possible to respecify the list of files to be edited
by giving the <B>:n</B> command a list of file names, or a pattern to
be expanded as you would have given it on the initial
<I>vi
</I>command.
<P>
&nbsp;&nbsp;If you are editing large programs, you will find the <B>:ta</B> command
very useful.  It utilizes a data base of function names and their locations,
which can be created by programs such as
<I>ctags,
</I>to quickly find a function whose name you give.
If the <B>:ta</B> command will require the editor to switch files, then
you must <B>:w</B> or abandon any changes before switching.  You can repeat
the <B>:ta</B> command without any arguments to look for the same tag
again.
<H2><A NAME="section49">7.4.</A>&nbsp;&nbsp;More about searching for strings
</H2>
<P>
&nbsp;&nbsp;When you are searching for strings in the file with <B>/</B> and <B>?</B>,
the editor normally places you at the next or previous occurrence
of the string.  If you are using an operator such as <B>d</B>,
<B>c</B> or <B>y</B>, then you may well wish to affect lines up to the
line before the line containing the pattern.  You can give a search of
the form <B>/</B><I>pat</I><B>/-</B><I>n</I> to refer to the <I>n</I>'th line
before the next line containing <I>pat</I>, or you can use <B>+</B> instead
of <B>-</B> to refer to the lines after the one containing <I>pat</I>.
If you don't give a line offset, then the editor will affect characters
up to the match place, rather than whole lines;
thus use &#147;+0&#148; to affect to the line which matches.
<P>
&nbsp;&nbsp;You can have the editor ignore the case of words in the searches it does
by giving the command <B>:se ic</B>CR.
The command <B>:se noic</B>CR turns this off.
<P>
&nbsp;&nbsp;Strings given to searches may actually be regular expressions.
If you do not want or need this facility, you should
<DL><DT><DD>
<PRE>
set nomagic
</PRE>
</DL>
in your EXINIT.
In this case, 
only the characters <B>&uarr;</B> and <B>$</B> are special in patterns.
The character <B>\</B> is also then special (as it is most everywhere in
the system), and may be used to get at the
an extended pattern matching facility.
It is also necessary to use a \ before a
<B>/</B> in a forward scan or a <B>?</B> in a backward scan, in any case.
The following table gives the extended forms when <B>magic</B> is set.
<P>
<DIV STYLE="margin-left: 20pt;">
<TABLE>
<TR><TD>&uarr;&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>at beginning of pattern, matches beginning of line</TD></TR>
<TR><TD><B>$</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>at end of pattern, matches end of line</TD></TR>
<TR><TD><B>.</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>matches any character</TD></TR>
<TR><TD><B>\&lt;</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>matches the beginning of a word</TD></TR>
<TR><TD><B>\&gt;</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>matches the end of a word</TD></TR>
<TR><TD><B>[</B><I>str</I><B>]</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>matches any single character in str</TD></TR>
<TR><TD><B>[</B><I>str</I><B>]</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>matches any single character not in str</TD></TR>
<TR><TD><B>[</B><I>x</I><B>-</B><I>y</I><B>]</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>matches any character between x and y</TD></TR>
<TR><TD><B>*</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>matches any number of the preceding pattern</TD></TR>
</TABLE>
</DIV>
<P>
If you use <B>nomagic</B> mode, then
the <B>. [</B> and <B>*</B> primitives are given with a preceding
\.
<H2><A NAME="section50">7.5.</A>&nbsp;&nbsp;More about input mode
</H2>
<P>
&nbsp;&nbsp;There are a number of characters which you can use to make corrections
during input mode.  These are summarized in the following table.
<P>
<DIV STYLE="margin-left: 20pt;">
<TABLE>
<TR><TD><B>^H</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>deletes the last input character</TD></TR>
<TR><TD><B>^W</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>deletes the last input word, defined as by <B>b</B></TD></TR>
<TR><TD><B>erase</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>your erase character, same as <B>^H</B></TD></TR>
<TR><TD><B>kill</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>your kill character, deletes the input on this line</TD></TR>
<TR><TD><B>\</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>escapes a following <B>^H</B> and your erase and kill</TD></TR>
<TR><TD><B>ESC</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>ends an insertion</TD></TR>
<TR><TD><B>DEL</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>interrupts an insertion, terminating it abnormally</TD></TR>
<TR><TD><B>CR</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>starts a new line</TD></TR>
<TR><TD><B>^D</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>backtabs over autoindent</TD></TR>
<TR><TD><B>0^D</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>kills all the autoindent</TD></TR>
<TR><TD><B>&uarr;^D</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>same as <B>0^D</B>, but restores indent next line</TD></TR>
<TR><TD><B>^V</B>&nbsp;&nbsp;&nbsp;&nbsp;</TD><TD>quotes the next non-printing character into the file</TD></TR>
</TABLE>
</DIV>
<P>
&nbsp;&nbsp;The most usual way of making corrections to input is by typing <B>^H</B>
to correct a single character, or by typing one or more <B>^W</B>'s to
back over incorrect words.  If you use <B>#</B> as your erase character
in the normal system, it will work like <B>^H</B>.
<P>
&nbsp;&nbsp;Your system kill character, normally <B>@</B>, <B>^X</B> or <B>^U</B>,
will erase all
the input you have given on the current line.
In general, you can neither
erase input back around a line boundary nor can you erase characters
which you did not insert with this insertion command.  To make corrections
on the previous line after a new line has been started you can hit ESC
to end the insertion, move over and make the correction, and then return
to where you were to continue.  The command <B>A</B> which appends at the
end of the current line is often useful for continuing.
<P>
&nbsp;&nbsp;If you wish to type in your erase or kill character (say # or @) then
you must precede it with a <B>\</B>, just as you would do at the normal
system command level.  A more general way of typing non-printing characters
into the file is to precede them with a <B>^V</B>.  The <B>^V</B> echoes
as a <B>&uarr;</B> character on which the cursor rests.  This indicates that
the editor expects you to type a control character.  In fact you may
type any character and it will be inserted into the file at that point
(<A HREF="paper-notes.html#7-3">footnote 7-3</A>).
<P>
&nbsp;&nbsp;If you are using <I>autoindent</I> you can backtab over the indent which
it supplies by typing a <B>^D</B>.  This backs up to a <I>shiftwidth</I>
boundary.
This only works immediately after the supplied <I>autoindent</I>.
<P>
&nbsp;&nbsp;When you are using <I>autoindent</I> you may wish to place a label at
the left margin of a line.  The way to do this easily is to type <B>&uarr;</B>
and then <B>^D</B>.  The editor will move the cursor to the left margin
for one line, and restore the previous indent on the next.  You can also
type a <B>0</B> followed immediately by a <B>^D</B> if you wish to kill
all the indent and not have it come back on the next line.
<H2><A NAME="section51">7.6.</A>&nbsp;&nbsp;Upper case only terminals
</H2>
<P>
&nbsp;&nbsp;If your terminal has only upper case, you can still use
<I>vi
</I>by using the normal
system convention for typing on such a terminal.
Characters which you normally type are converted to lower case, and you
can type upper case letters by preceding them with a \.
The characters { ~ } | ` are not available on such terminals, but you
can escape them as \( \&uarr; \) \! \'.
These characters are represented on the display in the same way they
are typed
(<A HREF="paper-notes.html#7-4">footnote 7-4</A>).
<H2><A NAME="section52">7.7.</A>&nbsp;&nbsp;Vi and ex
</H2>
<P>
&nbsp;&nbsp;<I>Vi
</I>is actually one mode of editing within the editor
<I>ex.
</I>When you are running
<I>vi
</I>you can escape to the line oriented editor of
<I>ex
</I>by giving the command
<B>Q</B>.
All of the
<B>:
</B>commands which were introduced above are available in
<I>ex.
</I>Likewise, most
<I>ex
</I>commands can be invoked from
<I>vi
</I>using :.
Just give them without the <B>:</B> and follow them with a CR.
<P>
&nbsp;&nbsp;In rare instances, an internal error may occur in
<I>vi.
</I>In this case you will get a diagnostic and be left in the command mode of
<I>ex.
</I>You can then save your work and quit if you wish by giving a command
<B>x</B> after the <B>:</B> which <I>ex</I> prompts you with, or you can
reenter <I>vi</I> by giving
<I>ex
</I>a
<I>vi
</I>command.
<P>
&nbsp;&nbsp;There are a number of things which you can do more easily in
<I>ex
</I>than in
<I>vi.
</I>Systematic changes in line oriented material are particularly easy.
You can read the advanced editing documents for the editor
<I>ed
</I>to find out a lot more about this style of editing.
Experienced
users often mix their use of
<I>ex
</I>command mode and
<I>vi
</I>command mode to speed the work they are doing.
<H2><A NAME="section53">7.8.</A>&nbsp;&nbsp;Open mode: vi on hardcopy terminals and &#147;glass tty's&#148;
</H2>
<P>
&nbsp;&nbsp;If you are on a hardcopy terminal or a terminal which does not have a cursor
which can move off the bottom line, you can still use the command set of
<I>vi,
</I>but in a different mode.
When you give a
<I>vi
</I>command, the editor will tell you that it is using
<I>open
</I>mode.
This name comes from the
<I>open
</I>command in
<I>ex,
</I>which is used to get into the same mode.
<P>
&nbsp;&nbsp;The only difference between
<I>visual
</I>mode
and
<I>open
</I>mode is the way in which the text is displayed.
<P>
&nbsp;&nbsp;In
<I>open
</I>mode the editor uses a single line window into the file, and moving backward
and forward in the file causes new lines to be displayed, always below the
current line.
Two commands of
<I>vi
</I>work differently in
<I>open:
</I><B>z
</B>and
<B>^R</B>.
The
<B>z
</B>command does not take parameters, but rather draws a window of context around
the current line and then returns you to the current line.
<P>
&nbsp;&nbsp;If you are on a hardcopy terminal,
the
<B>^R
</B>command will retype the current line.
On such terminals, the editor normally uses two lines to represent the
current line.
The first line is a copy of the line as you started to edit it, and you work
on the line below this line.
When you delete characters, the editor types a number of \'s to show
you the characters which are deleted.  The editor also reprints the current
line soon after such changes so that you can see what the line looks
like again.
<P>
&nbsp;&nbsp;It is sometimes useful to use this mode on very slow terminals which
can support
<I>vi
</I>in the full screen mode.
You can do this by entering
<I>ex
</I>and using an
<I>open
</I>command.
<P>
<H2>
Acknowledgements
</H2>
<P>
&nbsp;&nbsp;Bruce Englar encouraged the early development of this display editor.
Peter Kessler helped bring sanity to version 2's command layout.
Bill Joy wrote versions 1 and 2.0 through 2.7,
and created the framework that users see in the present editor.
Mark Horton added macros and other features and made the
editor work on a large number of terminals and Unix systems.
<H2>
Appendix: character functions
</H2>
<P>
&nbsp;&nbsp;This has been moved to the <A HREF="../vi.html"><I>vi</I>(1)</A>
manual page.
<P>
<A HREF="paper.html#toc">Table of Contents</A>
</BODY>
</HTML>
